{"name":"OCPtilecache","tagline":"Caching gateway to connect a CATMAID (or other) server to the Open Connectome Project Web Services","body":"ocpcatmaid\r\n==========\r\n\r\n[![Join the chat at https://gitter.im/openconnectome/ocpcatmaid](https://badges.gitter.im/Join%20Chat.svg)](https://gitter.im/openconnectome/ocpcatmaid?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)\r\n\r\nCaching gateway to connect a CATMAID server to the Open Connectome Project Web Services.\r\n\r\nThis repository can be cited using DOI http://dx.doi.org/10.5281/zenodo.9992\r\n\r\n  ** setup **\r\n  \r\n  Using mysql we need to creat the following tables.  The must be reabable by django, i.e. configure with the same database user used in django. \r\n\r\n    # RBTODO add foreign key constratin on datasets/metadata\r\n\r\n    create database ocpcatmaid;\r\n    use ocpcatmaid\r\n    CREATE TABLE contents ( highkey BIGINT, lowkey BIGINT, filename varchar(255), reftime TIMESTAMP, PRIMARY KEY ( highkey, lowkey)); \r\n    CREATE TABLE datasets ( dataset VARCHAR(255) PRIMARY KEY, datasetid INT UNIQUE AUTO_INCREMENT, ximagesz BIGINT, yimagesz BIGINT, zoffset BIGINT, zmaxslice BIGINT, zscale FLOAT );\r\n    CREATE TABLE metadata ( numtiles BIGINT);\r\n    CREATE TABLE fetching ( url VARCHAR(255) PRIMARY KEY );\r\n    INSERT INTO metadata (numtiles) VALUES (0);\r\n\r\n    # And a database for django\r\n    create database ocpcatmaid_django;\r\n\r\n  Make directories for logging. It has to have permission for the Web server (www-data or your user for the development server)\r\n\r\n    mkdir /var/log/ocpcatmaid\r\n    chown www-data /var/log/ocpcatmaid \r\n    mkdir /var/log/celery\r\n    chown www-data /var/log/celery \r\n\r\n\r\n  Starting the celery dev server.  The service uses two queues.  For testing you can start them together.  For deployments, we should have them running separately as daemons.\r\n\r\n    python manage.py celery worker --loglevel=info -Q celery,reclaim\r\n\r\n  If this works, stop the dev server.\r\n\r\n  Follow all of the instructions in the ocpcatmaid/setup directory.  Then:\r\n\r\n  Restart all the services\r\n  \r\n    sudo /etc/init.d/uwsgi restart ocpcatmaid\r\n    sudo /etc/init.d/supervisor restart \r\n    sudo /etc/init.d/nginx restart \r\n\r\n  And check their status\r\n\r\n    sudo /etc/init.d/uwsgi status ocpcatmaid\r\n    sudo /etc/init.d/supervisor status \r\n    sudo /etc/init.d/nginx status \r\n\r\n  If all are running you should be good to go.\r\n\r\n  ** Configuring in CATMAID **\r\n\r\n  Create a stack to a remote site.  It must have the following properties:\r\n    * Image base = http://localhost/ocpcatmaid/[token]/\r\n    * File extension = png\r\n    * Tile width = 512\r\n    * Tile height = 512\r\n  \r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}